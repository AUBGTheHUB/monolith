services:
  py-api:
    image: ghcr.io/AUBGTheHUB/monolith:${GIT_COMMIT_HASH:-latest}
    secrets:
      - env
      - address
      - domain
      - db-url
      - secret-key
      - secret-auth-token
    environment:
      - ENV=/run/secrets/env
      - ADDRESS=/run/secrets/address
      - DOMAIN=/run/secrets/domain
      - PORT=8080
      - DATABASE_URL=/run/secrets/db-url
      - SECRET_KEY=/run/secrets/secret-key
      - SECRET_AUTH_TOKEN=/run/secrets/secret-auth-token
    expose:
      - "8080"
    ports:
      - "8080:8080"
    volumes:
      - ./services/py-api/shared:/app/shared
      - /etc/letsencrypt:/etc/letsencrypt

    networks:
      - monolith
    restart: always

networks:
  monolith:
    driver: bridge

secrets:
  env:
    external: true
  address:
    external: true
  domain:
    external: true
  db-url:
    external: true
  secret-key:
    external: true
  secret-auth-token:
    external: true
